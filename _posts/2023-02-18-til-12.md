---
title: "[TIL] Lambda, API Gateway, S3 ì„ í™œìš©í•œ ì´ë¯¸ì§€ ì—…ë¡œë“œ (2)"
excerpt: "ì„œë²„ë¦¬ìŠ¤ë¡œ ì´ë¯¸ì§€ ì—…ë¡œë“œë¥¼ í•´ë³´ì.. (ë„ì „) ğŸ™‚"

categories:
  - TIL
tags:
  - [TIL]

permalink: /category/til/11

toc: true
toc_sticky: true

date: 2023-02-18
last_modified_at: 2023-02-18
---
## ğŸ¦¥ í˜„ì¬ê¹Œì§€ êµ¬ì„±ëœ ê²ƒ

<img src="https://imgur.com/VvT1MpP.png">

## ğŸ¦¥ Lambda í•¨ìˆ˜ ì „ì²´ ì½”ë“œ (ê¸°ë³¸)

```
package helloworld;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.URL;
import java.util.HashMap;
import java.util.Map;
import java.util.stream.Collectors;

import com.amazonaws.services.lambda.runtime.Context;
import com.amazonaws.services.lambda.runtime.RequestHandler;
import com.amazonaws.services.lambda.runtime.events.APIGatewayProxyRequestEvent;
import com.amazonaws.services.lambda.runtime.events.APIGatewayProxyResponseEvent;

/**
 * Handler for requests to Lambda function.
 */
public class App implements RequestHandler<APIGatewayProxyRequestEvent, APIGatewayProxyResponseEvent> {

    public APIGatewayProxyResponseEvent handleRequest(final APIGatewayProxyRequestEvent input, final Context context) {
        Map<String, String> headers = new HashMap<>();
        headers.put("Content-Type", "application/json");
        headers.put("X-Custom-Header", "application/json");

        APIGatewayProxyResponseEvent response = new APIGatewayProxyResponseEvent()
                .withHeaders(headers);
        try {
            final String pageContents = this.getPageContents("https://checkip.amazonaws.com");
            String output = String.format("{ \"message\": \"hello world\", \"location\": \"%s\" }", pageContents);

            return response
                    .withStatusCode(200)
                    .withBody(output);
        } catch (IOException e) {
            return response
                    .withBody("{}")
                    .withStatusCode(500);
        }
    }

    private String getPageContents(String address) throws IOException{
        URL url = new URL(address);
        try(BufferedReader br = new BufferedReader(new InputStreamReader(url.openStream()))) {
            return br.lines().collect(Collectors.joining(System.lineSeparator()));
        }
    }
}

```

## ğŸ¦¥ Lambda í•¨ìˆ˜ ì½”ë“œ ì´í•´í•˜ê¸°

### ğŸŒ¿ RequestHandler<Input, Output>

- API ë¬¸ì„œ ì„¤ëª… : Lambda ìš”ì²­ í•¸ë“¤ëŸ¬ëŠ” ì…ë ¥ê°’ê³¼ ì¶œë ¥ê°’ê³¼ ê°™ì€ POJO ë¥¼ ì‚¬ìš©í•˜ëŠ” AWS Lambda í•¨ìˆ˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì„ implement í•œë‹¤. 

#### ğŸ’¡ handleRequest(I input, Context context)
- lambda í•¨ìˆ˜ `ìš”ì²­ì„ ë‹¤ë£¬ë‹¤`
- `input` ì€ lambda í•¨ìˆ˜ì˜ ì…ë ¥ê°’
- `context` ëŠ” ëŒë‹¤ ì‹¤í–‰ í™˜ê²½ì˜ ì»¨í…ìŠ¤íŠ¸ ê°ì²´
- `ë¦¬í„´ê°’` : lambda í•¨ìˆ˜ì˜ ê²°ê³¼



### ğŸŒ¿ API Gateway ì˜ ì½˜í…ì¸  ìœ í˜•
- API Gatewayë¥¼ í†µí•´ íŒŒì¼ì„ ì „ì†¡í•  ë•Œ íŒŒì¼ì€ Base64 (ë¬¸ìë¡œ ì¸ì½”ë”©ëœ ìƒíƒœ)ë¡œ ë„ì°©í•œë‹¤.
- ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” base64 decoder ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤. 

